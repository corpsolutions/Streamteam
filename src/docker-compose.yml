version: '3.4'

services:
  elasticsearch:
    image: elasticsearch:8.2.2
  
  logstash:
    image: logstash:8.2.2
  
  kibana:
    image: kibana:8.2.2
  
  psql:
    image: postgres:latest
  
  mongo:
    image: mongo:latest
  
  redis:
    image: redis:alpine
  
  rabbitmq:
    image: rabbitmq:3-management-alpine
  
  envoy:
    image: envoyproxy/envoy:v1.15.0
  
  streamteamagg:
    image: ${REGISTRY:-sts}/streamteamagg:${PLATFORM:-linux}-${TAG:-latest}
    build:
      context: .
      dockerfile: ApiGateways/Web.Bff.Streamteamagg/aggregator/Dockerfile
    depends_on:
      - psql
      - mongo
      - rabbitmq
      - identity-api
  
  webstatus:
    image: ${REGISTRY:-sts}/webstatus:${PLATFORM:-linux}-${TAG:-latest}
    build:
      context: .
      dockerfile: Web/WebStatus/Dockerfile
  
  identity-api:
    image: ${REGISTRY:-sts}/identity.api:${PLATFORM:-linux}-${TAG:-latest}
    build:
      context: .
      dockerfile: Services/Identity/Identity.API/Dockerfile
    depends_on:
      - psql